<html>

<head>

  <link href="../assets/css/www.min.css" rel="stylesheet" type="text/css" media="screen" />
  <link href="../assets/css/main.css" rel="stylesheet" type="text/css" />
  <link href="../assets/css/code-cadets-custom.css" rel="stylesheet" type="text/css" />
  <link href="../assets/css/code-cadets-custom-dark.css" rel="stylesheet" type="text/css" />


  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

  <link rel="stylesheet" type="text/css" href="../assets/js/highlight/styles/atom-one-dark.css">
  <script type="text/javascript" src="../assets/js/highlight/highlight.pack-af76728dfe3d98887947abb9090adcb18dd6d1ad0f092d60360179561eee1e19.js"></script>

  <script>hljs.initHighlightingOnLoad();</script>

  <title>Lab 1: Introduction</title>

</head>

<body>

  <header>

    <h1><a href="../index.html">Code Cadets Extension 2018</a></h1>

  </header>

    <div id="body-wrap" role="main">
      <div id="body">

        <div id="content">
  
  <div class="marginleft ">
  
  
    
    
      <div> 
        <h1 class="post-title">Lab 1: Introduction</h1>
    </div>
  
  </div>
  
  
      <div class="doublewide nomargintop" style="float:none; display:block">
        <h2 id="outline">Outline</h2>

<p>In this week’s lab you will:</p>

<ol>
  <li>get your discoboard and connect it to the computer</li>
  <li>create your first program using the VSCode IDE</li>
  <li>compile, run and debug your first program</li>
</ol>

<h2 id="introduction">Introduction</h2>

<p>The labs for this course have a few different recurring parts, and they will be
presented using different coloured boxes:</p>

<p class="info-box">General notes &amp; information will be highlighted in a blue box.</p>

<p class="think-box">Sometimes you need to <strong>think</strong> about stuff before you go ahead. If you see
something in a pink box (because your brain is
pink—<a target="_blank" href="http://brainathlete.com/color-brain/">sortof</a>), that’s your clue to
pause and <em>think</em>—how do you expect the next part will work? Take a moment to
think before you blaze away and start coding, because then you can check whether
you really understand what’s going on or whether you’re just copy-pasting stuff
without really understanding it. If you <em>don’t</em> understand it perfectly, that’s
ok—ask your lab neighbour (or your tutor) to help you understand.</p>

<p class="talk-box">We don't want you to learn in isolation. The lab
sessions will have plenty of chances to <strong>discuss</strong> things with others. If you see a green box, read it and then discuss the question with
your lab neighbour (someone sitting near you). In this course, as in most (all?)
others, your fellow students are your best resource. If you have a problem with
your work, or if there’s something you don’t understand, the first thing you
should do (after thinking about it for at least ten seconds) should be to ask
another student. They might not know the answer straight away, but even if they
don’t, you might find that between the two of you you can work it out. If you
can’t, then of course you can ask the teachers—but your teacher might not be able
to help you immediately. This also means that if you’re helping one of your
fellow students understand something, put yourself in their shoes. It takes
courage to ask a question, especially if you feel like everyone else in the lab
knows what’s going on (although that certainly isn’t true). Be gentle and
helpful in your answers, and remember that you can be honest about stuff that
you don’t know—you’re all on this journey together.</p>

<p class="extension-box">Computer organisation and program execution are <em>huge</em> topics, and mastering them takes a lifetime. So the material
in these lab sessions will only cover the fundamentals. However, sometimes there
are interesting <strong>extension</strong> exercises you might try if you want to go deeper,
and these will be in a purple box. If you don’t know how to approach the
problems in the purple boxes, that’s ok too.</p>

<p>These coloured boxes will be used consistently through the lab material, so take
a moment to familiarise yourself with what the different colours <em>mean</em>, or at
least remember that you can come back here and check at any time.</p>

<h2 id="exercise-0-setting-up-the-software-environment">Exercise 0: setting up the software environment</h2>

<p>Setting things up deserves <a target="_blank" href="../software-setup/index.html">it’s own page</a>. Go have a look, see you back here when
you’re done :)</p>

<h2 id="getting-your-discoboard">Exercise 1: getting your discoboard</h2>

<p>During this session we will give you a discoboard and USB
cable of your very own—this is <strong>yours to keep forever</strong>. How exciting!</p>

<p><img src="board-upside-down-a2b7497e29c13f3a77a59f38de0ae449a1bf4bf50280763673d2ff98b35998cd.jpg" /></p>

<h2 id="connecting-the-board">Exercise 2: connecting the board to the computer</h2>

<p><img src="boxed-discoboard-489acb2f6c2ca0ee4849d369735a0a51445ea4fc3034e86b6336d68518931217.jpg" /></p>

<p>The discoboard connects to your computer via
a <a target="_blank" href="https://en.wikipedia.org/wiki/USB#Mini_and_micro_connectors">mini-USB</a> cable. We also have USB-C to USB-A adapters if you have a new MacBook with USB-C ports.</p>

<p>As far as electronics go, this board isn’t <em>super</em> fragile, but you’ll still
need to be careful with it when you’re handling it and carting it around. That’s
why you got it in a plastic container with an antistatic bag—keep the discoboard in it's antistatic bag and put that, and your cable, in the plastic container. If you’re not used to handling electronics, here are a few tips:</p>

<p><img src="holding-discoboard-66b34363f596044753433f088c8c6af4e5dad46d7392670593c4a21ff3dbbedc.jpg" /></p>

<ul>
  <li>handle it by the edges (as in the photo)</li>
  <li>don’t touch any of the pins or little microchips on the board</li>
  <li>keep the plastic case to carry the board around</li>
  <li>be careful of static electricity—if you’re the sort of person who regularly
shocks themselves, then you need to ground yourself before touching the board</li>
  <li>the USB cable you received will only fit in <strong>one</strong> end of the board (even
though there’s a different USB connector on the other end) so if it’s not
going in, try the other end—don’t try to force it!</li>
</ul>

<p>Once you’ve received your new discoboard, plug it in to your computer—the
full-size USB end goes into the computer, and the mini end of the USB cable
goes into the connector on the discoboard (up the “top” end, closer to the LCD
screen).</p>

<h2 id="exercise-3-your-first-discoboard-program">Exercise 3: your first discoboard program</h2>

<p class="talk-box">With your lab neighbour, open up the main <a target="_blank" href="https://code.visualstudio.com/docs/editor/extension-gallery">VSCode documentation
website</a>. Discuss
with them: what makes a good documentation website?</p>

<p>Now that you’ve connected your board to the computer it’s time to turn
everything on and see if it works. This exercise is a bit longer, so it’s broken
down into stages: clone, edit, build &amp; run.</p>

<h3 id="fork--clone">Fork &amp; clone</h3>

<p>In this course all the lab templates are stored in Git - with each lab having its own repo. If you have never used Git before don't fear - it is built into macOS and we will give you a quick tutorial (or you can ask some of the senior students who have used Git previously). We recommend that you have a "discoboard" folder somewhere on your computer where you can keep <em>all</em> of
your stuff related to these activities.</p>

<p>Ok, now here goes:</p>

<ol>
  <li>clone the <a target="_blank" href="https://github.com/CanberraGrammar/cc-ext-2018-discoboard-lab-1">lab 1 template</a> to your local machine</li>
</ol>

<p>You can do the “git clone” step in the terminal, or your favourite git client,
it doesn’t matter. If you like, you can use VSCode’s built-in git support:
here’s a link to the <a target="_blank" href="https://code.visualstudio.com/docs/editor/versioncontrol#_cloning-a-repository">general docs on this
view</a>,
and here’s the <a target="_blank" href="https://code.visualstudio.com/docs/editor/versioncontrol#_cloning-a-repository">specific instructions on how to clone a
repo</a>.</p>

<p>After you’ve cloned, open the top-level folder in VSCode. If you used the
integrated VSCode git clone command, this will happen automatically. If you
cloned the repo some other way, you’ll need to open the folder yourself with
<code>File: Open...</code> in the command palette. Once you’ve done that you should see
something like this:</p>

<p><img src="vscode-open-workspace-66c1ae3b566ae7721678179b781c60875c725b9826c1afdda2094651869179f1.png" /></p>

<p>Again, the VSCode docs have a <a target="_blank" href="https://code.visualstudio.com/docs/getstarted/userinterface#_command-palette">good explanation of the user
interface</a>.</p>

<p>Now, in the <strong>Explorer</strong> view, open the <code>src/main.S</code> file, you should see
something like this:</p>

<p><img alt="" the="" main.s="" file="" in="" vscode="" src="vscode-main-S-17f66ddbff7cdd8b657a217b7346c4ffa466f46a8cacc04006c8feb9a2db31b0.png" /></p>

<p class="think-box">Based on your experience using rPeANUt, what do you think this
program does?</p>

<h3 id="edit">Edit</h3>

<p>Add some code so that <code>main.S</code> looks like this:</p>

<pre><code class="language-ARM">  .syntax unified
  .global main
  .type main, %function

main:
  mov r1, 0

loop:
  add r1, 1
  b loop
</code></pre>

<p>Save the file when you’re done. Don’t worry if you don’t understand all the
details at this stage—the goal for this week’s lab is just to plug things in,
turn them on, and make sure that everything’s working. If you have any problems,
let your teacher know now.</p>

<h3 id="build">Build</h3>

<p>You can build (or compile—they mean the same thing in this context) your
program using the <strong>Build</strong> command (<code>PlatformIO: Build</code> in the <a target="_blank" href="https://code.visualstudio.com/docs/getstarted/userinterface#_command-palette">command
palette</a>).
You’ll see some stuff printed to the
<a target="_blank" href="https://code.visualstudio.com/docs/editor/integrated-terminal">terminal</a> (near
the bottom of your VSCode window), and when it’s done it should look <em>something</em>
like this:</p>

<p><img src="vscode-after-build-command-c0ca4084ae446277c78305d9ba358af7df21c5ed4691be3a7700f42fabd21c1d.png" /></p>

<p>If you’re running this process for the first time, PlatformIO will need to
download some more stuff—again, this might take several minutes (perhaps up to
half an hour if everyone’s hitting the servers at
once) Be patient, you only have to do this once on any given computer, the next
time it’ll be super-quick.</p>

<p class="talk-box">While you’re waiting, how about you do a bit of research about how to use Git - particuarly if you have never used it before.</p>

<h3 id="upload">Upload</h3>

<p>You’ve built the program <em>on your laptop/desktop</em> (or phone, or
toaster—whatever machine VSCode is running on). To run it <em>on your discoboard</em>
you need to upload it with the <strong>Upload</strong> (<code>PlatformIO: Upload</code>). Again,
afterward it should look something like this:</p>

<p><img src="vscode-after-upload-command-3481cb029f9c29c24b4ce8c3cd6474b342960014a27e23277066a2e297c330dd.png" /></p>

<p>If you get errors at this point, then they’ll be printed (probably in red) in
the terminal. Try and figure out what’s going wrong yourself.</p>

<p class="info-box">The most common error you might encounter at this stage is a flash failure error: <code>Error: init mode failed (unable to connect to target)</code>. This is likely to be the "first upload" problem. Head across to the <a target="_blank" href="../software-setup/index.html#flash-failure">flash failure</a> troubleshooting section of the software setup to look at how to fix this issue.</p>

<h3 id="run">Run</h3>

<p>To run the program on your discoboard, we’ll use VSCode’s built-in
<strong>debugger</strong>—an invaluable tool for making things work right when we’re
writing programs for the discoboard. You may have used a debugger like this
before, or you may not have—that’s ok! We’ll lead you through the basics in
the labs over the next couple of weeks.</p>

<p>Open up the <a target="_blank" href="https://code.visualstudio.com/docs/editor/debugging"><strong>Debug</strong>
view</a> and make sure the
<em>ARM On-Chip Debug</em> configuration is selected in the drop-down menu (if you
select a different config, e.g. the PlatformIO config, then it won’t work):</p>

<p><img src="vscode-select-debug-config-b9c74a68ae0f64d5ae4bc5c8ec8d5197837a54d58bb137445125137a0b296fc4.png" /></p>

<p>Click the green play button to run your program, pausing (“breaking”) on entry.</p>

<p><img src="vscode-debugging-in-progress-60385411587bb263771f37c9966d7cb282a7b09174c29d8fff03ae736e2b8082.png" /></p>

<p>The highlighted yellow line of assembly code (shown in the above screenshot)
represents where the program is “up” to. When you first start it running, the
IDE creates a <a target="_blank" href="https://en.wikipedia.org/wiki/Breakpoint"><strong>breakpoint</strong></a> at the
<code>main:</code> label in your program, so when your program reaches that line of code it
stops and waits for further instructions (from you!).</p>

<p class="info-box">When the program first starts executing it will likely breakpoint/pause in the <code>startup_stm32l476xx.S</code> file. You can just use the debugger controls to step through until you break on the <code>main:</code> label in your program.</p>

<p class="talk-box">What is the purpose of the <code>startup_stm32l476xx.S</code> file? Try to figure out what it does and why it is used when your program first loads.</p>

<p>At this point, you can step through the code one instruction at a time using the
debug controls:</p>

<p><img src="vscode-debugger-arrows-8fba966a7f3a9dd72615abbdd7d41b2359335a8cbcccbddbd218e291e12b0dbf.png" /></p>

<p class="talk-box">Discuss with your neighbour—what do all these debug control buttons do?
Play around with them together—can you see what effect they’re having on the
program executing on your discoboard? Are you <em>pumped</em>?</p>

<p>If you want your program to keep running (i.e. to “unpause” the program) just
hit the green play button (although it’s called <em>continue</em> rather than <em>play</em>
when you’re debugging, because it continues after you last paused the
execution). Once it’s running, you can pause it again by hitting the pause
button, and even stop it with the red stop button.</p>

<p>Once it’s stopped, you can restart the whole process again in a new debugging
session by going back to the start of these instructions.</p>

<p class="info-box">Debuggers are always a bit flaky; sometimes they get stuck, sometimes the
“current line indicator” disappears, sometimes it doesn’t stop at the
breakpoints correctly, or some other problem. You’ll get the hang of recognising
when things have gone wrong &amp; how to fix them, so don’t be too frustrated if
things don’t work right. Remember that it’s ok to use the stop or restart
buttons to try and get things back on track, or (worst-comes-to-worst) unplug
and re-plug your discoboard.</p>

<p>You can also examine the values of your registers in the <strong>CORTEX REGISTERS</strong>
viewlet under the Debug View (see the bottom left corner in the below
screenshot):</p>

<p><img src="vscode-register-view-a8dff9a49f7097a4e4dfdf92785e507b627847690e1ba76bc72709fa3ad567a7.png" /></p>

<p>If you want to control exactly <em>where</em> the system pauses for debugging, you can
set a new breakpoint by double-clicking in the left-hand “gutter” (or margin) of
the code view in the IDE. You should see a little red dot appear:</p>

<p><img src="vscode-breakpoint-5bd2e6cee66fdcdccf65b34c9663a096c5b646eb3838aff566489c077c04d4f2.png" /></p>

<p class="think-box">The program isn’t running on your laptop—it’s running on
your discoboard. What does that <em>mean</em>? What are the implications for the way
you run &amp; debug your program?</p>

<h2 id="summary">Summary</h2>

<p>Congratulations! In this lab you</p>

<ol>
  <li>plugged in your board</li>
  <li>opened up the IDE</li>
  <li>built, uploaded, run &amp; debug a basic program on your board</li>
</ol>

<p>Next week, you’ll start thinking about what the assembly code you wrote does,
and what it actually <em>looks like</em> in the memory of your discoboard.</p>

<p class="info-box">Make sure you pack up your board and USB
cable carefully.</p>

<p class="extension-box">There’s no specific extension content this week. Having said that, the board is
now yours, so you can program it however you like.</p>

      </div>

<footer>

  <p>This material was written and prepared by Dr. Ben Swift for <a target="_blank" href="https://cs.anu.edu.au/courses/comp2300/">COMP2300</a> at the Australian National University, licenced under <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>. Parts of the content have been changed/adapted for use by Canberra Grammar School. A very big thank you to Dr. Swift for allowing us to use his awesome material.</p>

  </footer>

  </body>

  </html>